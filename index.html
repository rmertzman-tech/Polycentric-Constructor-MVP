<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Polycentric Constructor Lab (MVP)</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
       .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 30px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        h1, h2 {
            color: #1a4d2e;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }
       .module {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 95%;
        }
        button {
            background-color: #4a8670;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #3c6e5a;
        }
       .output {
            margin-top: 20px;
            padding: 15px;
            border: 1px dashed #708090;
            border-radius: 5px;
            background-color: #e6f7ff;
            white-space: pre-wrap;
        }
       .coherence-bar {
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
       .coherence-fill {
            height: 100%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
            text-align: center;
            color: white;
            line-height: 30px;
            font-weight: bold;
        }
       .danger {
            background-color: #ff4d4d!important;
        }
       .warning {
            background-color: #ffc107!important;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>The Polycentric Constructor Lab: Core Logic MVP</h1>
    <p><em>Demonstrating Functional Equivalence and the Cost of Moral Injury. (Ref: From Constructor Ignition to Institutional Coherence)</em></p>

    <div class="module">
        <h2>Module 1: Functional Equivalence ($\Psi_{1}$) and ITA Stabilization</h2>
        <p><strong>Goal:</strong> Show that coordination is successful when focused on **The Deed** (functional outcome) rather than **The Reasons** (ideological belief).</p>
        
        <label>Select Coalition Members (Incompatible Beliefs, Compatible Capabilities):</label>
        <div style="display: flex; gap: 20px; margin-top: 10px;">
            <label><input type="checkbox" id="agent1" data-broa="Mission: Sanctity of Life; Ontology: Spiritual" checked disabled> Catholic Nuns</label>
            <label><input type="checkbox" id="agent2" data-broa="Mission: Worker Power; Ontology: Materialist" checked disabled> Socialist Co-op</label>
            <label><input type="checkbox" id="agent3" data-broa="Mission: Duty/Honor; Ontology: Service" checked disabled> Veterans Group</label>
        </div>
        <div style="margin-top: 15px; background: #fff8e1; padding: 10px; border-left: 4px solid orange;">
            <strong>Core Conflict (BROA+):</strong> The philosophical beliefs and motivations of the selected agents are fundamentally incompatible.
        </div>

        <button onclick="runEquivalenceTest()">1. Initiate Functional Equivalence ($\Psi_{1}$) Test</button>
        
        <div class="output" id="outputEquivalence">
            <p><strong>$\Psi_{1}$ Status:</strong> Select coalition members and initiate the test.</p>
        </div>
    </div>

    <div class="module">
        <h2>Module 2: Moral Injury (ATCF) and the Care Bond</h2>
        <p><strong>Goal:</strong> Simulate how systemic pressure (Sludge) degrades agent coherence (ATCF), and how the Incentive Architecture (Care Bond) acts as a firewall.</p>

        <label for="friction-slider">Systemic Friction / Ethical Sludge (%):</label>
        <input type="range" id="friction-slider" min="0" max="100" value="30" oninput="updateSimulation()">
        <span id="friction-value">30%</span>

        <label>Agent Coherence Index ($\text{ATCF}(O_i)$):</label>
        <div class="coherence-bar">
            <div class="coherence-fill" id="coherence-fill" style="width: 70%;">70% (HIGH)</div>
        </div>
        <p style="font-size: 0.9em; margin-top: 5px;">*ATCF measures Autonomy and Temporal Coherence of Feeling of Self - essential for sustained agency.</p>

        <label for="bond-toggle">Care Bond SLL Firewall:</label>
        <button id="bond-toggle" onclick="toggleCareBond()">Activate SLL Financial Firewall (OFF)</button>
        
        <div class="output" id="outputMoralInjury">
            <p><strong>Simulation Status:</strong> Current friction is low. Management is financially rational.</p>
        </div>
    </div>

    <div class="module">
        <h2>Module 3: The Constructor Ignition Sequence</h2>
        <p><strong>Conceptual Summary:</strong> The full architecture in action.</p>
        <pre id="sequence-output" style="background: #e9e9e9; padding: 15px; border-radius: 5px;">
1. Systems Omission (Coordination Failure/Sludge) [1]
   - Problem: Private Equity profits by creating Moral Injury (ATCF Loss).
2. Constructor Ignition / MVC (Minimal Viable Coalition) [1, 1]
   - Action: Small group (3 Agents) agrees to coordinate on a low-risk Proof of Care (e.g., planting 7 trees or signing the SLL contract).
3. Functional Equivalence Recognition ($\Psi_{1}$) [1]
   - Strategy: Boundary agents recognize incompatible beliefs yield compatible action (The Deed).
4. Stabilization via ITA (Incompletely Theorized Agreement) [1]
   - Formalization: The master contract legally formalizes agreement on The Deed, but preserves theoretical silence on The Reasons (protecting ATCF).
5. Self-Repair via Incentive Architecture [1]
   - Mechanism: The Care Bond (SLL) makes management exploitation financially irrational, forcing the system to self-repair by hiring staff, thus protecting the nurse's ATCF.
6. Scaling (Bootstrap Dynamics) [1]
   - Outcome: Success attracts capital and partners, enabling replication across the Adaptive Moral Commonwealth.
        </pre>
    </div>
</div>

<script>
    // --- Global State ---
    let isCareBondActive = false;
    const initialCoherence = 100;

    // --- Module 1 Logic ---
    function runEquivalenceTest() {
        const output = document.getElementById('outputEquivalence');
        
        // The core teaching point: functional equivalence achieved by focusing on the 'WHAT'
        const deed = "Maintain Patient Dignity (Protocol M)";
        
        const resultText = `
**Coordination Success: Functional Equivalence ($\Psi_{1}$)**

**The Deed (The WHAT):** The coalition agrees on the functional outcome: "${deed}".
**The Reasons (The WHY):** Agents maintain their incompatible, authentic motivations:
- **Catholic Nuns:** Fulfillment of sanctity of life (Spiritual A+).
- **Socialist Co-op:** Fulfillment of worker power and rights (Political A+).
- **Veterans Group:** Fulfillment of duty and honor (Moral A+).

**ITA as Stabilizer:** The master contract is the **Incompletely Theorized Agreement (ITA)**.[2, 1]
It formalizes the agreement on the shared Deed while mandating theoretical silence on the Agents' core, divergent beliefs. This protects Autonomy Preservation ($ATCF(O_i)$) for all coalition members, allowing the alliance to scale and persist despite deep political disagreements.[1]
`;
        output.innerHTML = resultText.trim().replace(/\n/g, '<br>');
    }

    // --- Module 2 Logic ---
    function toggleCareBond() {
        isCareBondActive =!isCareBondActive;
        const button = document.getElementById('bond-toggle');
        button.textContent = isCareBondActive 
           ? 'SLL Financial Firewall (ACTIVE)' 
            : 'Activate SLL Financial Firewall (OFF)';
        button.style.backgroundColor = isCareBondActive? '#28a745' : '#4a8670';
        updateSimulation();
    }

    function updateSimulation() {
        const slider = document.getElementById('friction-slider');
        const friction = parseInt(slider.value);
        document.getElementById('friction-value').textContent = friction + '%';
        
        const output = document.getElementById('outputMoralInjury');
        const fill = document.getElementById('coherence-fill');

        // Non-linear decay of ATCF based on stress (modeling PFC impairment/Moral Injury) [1]
        let atcfIndex = Math.max(0, initialCoherence - Math.pow(friction, 1.5) * 0.1); 

        let statusMessage = "";
        let fillClass = "";

        if (friction > 70) {
            statusMessage += "<strong>CRITICAL SYSTEMIC FAILURE:</strong> Friction is high! This represents high Sludge/coordination cost (e.g., chronic understaffing).[3]\n\n";
            statusMessage += "Systemic pressure is causing severe ATCF loss and Moral Injury.[1, 1]";
            fillClass = 'danger';
        } else if (friction > 40) {
            statusMessage += "<strong>WARNING:</strong> Significant Moral Stress Tax (Ethical Sludge) on Agency.\n\n";
            statusMessage += "The agentâ€™s Prefrontal Cortex (PFC) function is impaired, leading to fatigue and high risk of turnover (Cost: ~$9B/yr for nurses).[1]";
            fillClass = 'warning';
        } else {
            statusMessage += "System status GREEN. Moral stress is within baseline tolerance.\n\n";
            statusMessage += "Management's choices are financially rational, as system costs (turnover/injury) are currently externalized (not on the ledger).[1]";
        }
        
        // --- Care Bond Intervention ---
        if (isCareBondActive) {
            const recoveryFactor = Math.min(1.0, (100 - friction) / 100) * 20; // Recovery effect
            atcfIndex = Math.min(100, atcfIndex + recoveryFactor);
            
            if (friction > 40) {
                statusMessage = statusMessage.replace(/Management is financially rational/, "Management is **FINANCIALLY IRRATIONAL**.[1]");
                statusMessage += "\n\n**CARE BOND INTERVENTION ACTIVE:** High Moral Injury metrics (ATCF loss) triggered the Care Bond Penalty (e.g., interest rate spike).[1] The financial cost of *exploiting* the nurse is now higher than the cost of *hiring* staff, forcing system self-repair (Incentive Architecture).[1] ATCF loss is resisted.";
                fillClass = (friction > 70)? 'warning' : 'coherence-fill';
            }
        } else if (friction > 40) {
            fillClass = (friction > 70)? 'danger' : 'warning';
        } else {
             fillClass = 'coherence-fill';
        }

        // Update visuals
        const finalATCF = Math.round(atcfIndex);
        fill.style.width = finalATCF + '%';
        fill.textContent = finalATCF + '% (' + (finalATCF > 70? 'HIGH' : (finalATCF > 40? 'RISK' : 'COLLAPSE')) + ')';
        fill.className = 'coherence-fill ' + fillClass;
        output.innerHTML = statusMessage.trim().replace(/\n/g, '<br>');
    }

    // Initialize on load
    window.onload = function() {
        runEquivalenceTest();
        updateSimulation();
    };

</script>

</body>
</html>
